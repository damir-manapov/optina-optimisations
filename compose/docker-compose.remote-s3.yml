# Trino with remote S3 storage (Selectel Cloud Storage)
# Usage: docker compose -f docker-compose.yml -f docker-compose.remote-s3.yml up -d trino
#
# Required environment variables:
#   S3_ACCESS_KEY - Your S3 access key
#   S3_SECRET_KEY - Your S3 secret key
#
# Example:
#   export S3_ACCESS_KEY=your-access-key
#   export S3_SECRET_KEY=your-secret-key
#   pnpm compose:up:trino:remote-s3

services:
  # Disable local MinIO - not needed with remote S3
  minio:
    image: busybox:1.37
    command: ["true"]
    deploy:
      replicas: 0

  # Skip bucket creation - bucket should exist on remote S3
  create-minio-bucket:
    image: busybox:1.37
    command: ["true"]
    deploy:
      replicas: 0

  trino:
    environment:
      - S3_ACCESS_KEY=${S3_ACCESS_KEY}
      - S3_SECRET_KEY=${S3_SECRET_KEY}
    volumes:
      # Override catalog config to use remote S3
      - ./trino/catalog/iceberg.remote-s3.properties:/etc/trino/catalog/iceberg.properties:ro
      # Override exchange manager to use remote S3
      - ./trino/exchange-manager.remote-s3.properties:/etc/trino/exchange-manager.properties:ro
    depends_on:
      nessie:
        condition: service_healthy
